setup publisher/subscriber system on the server so pie can send events to it.

sudo apt update
sudo apt install mosquitto mosquitto-clients

![1767270903753](image/01-01-2026/1767270903753.png)

starting the service:

sudo systemctl enable mosquitto
sudo systemctl start mosquitto

![1767270949504](image/01-01-2026/1767270949504.png)

MQTT uses port 1883 on http

Open ports on server: update the ip table and security list on cloud.

sudo iptables -A INPUT -p tcp --dport 1883 -j ACCEPT

![1767272015212](image/01-01-2026/1767272015212.png)

![1767272055695](image/01-01-2026/1767272055695.png)

check ports listening: ss -nltp

![1767272193402](image/01-01-2026/1767272193402.png)

test basic communication

on the pi or a local linux machine:
mosquitto_sub -h your.server.ip -t test/topic

on the server:
mosquitto_pub -h your.server.ip -t test/topic -m "hello"
fix ports if necessary and save

i ran sudo iptables -I INPUT 5 -p tcp --dport 1883 -m conntrack --ctstate NEW -j ACCEPT

![1767274152501](image/01-01-2026/1767274152501.png)
![1767274217423](image/01-01-2026/1767274217423.png)

confirm on pi communication:

![1767274242550](image/01-01-2026/1767274242550.png)

part 2:

need to setup a simple test by pushing some events from pie to our mqtt server expose websockets and transmit to frontend.
So full test of having frontend updates and the camera going all real time data.

opening port 9001 for mqtt websocket connection http upgrade

sudo iptables -I INPUT 5 -p tcp --dport 9001 -m conntrack --ctstate NEW -j ACCEPT
sudo iptables-restore < /etc/iptables/rules.v4
![1767279019959](image/01-01-2026/1767279019959.png)

![1767279151186](image/01-01-2026/1767279151186.png)

configure mosquitto to use websockets

sudo nano /etc/mosquitto/mosquitto.conf

added listener and protocol for the port and transmission method 1883 and 9001

![1767279353181](image/01-01-2026/1767279353181.png)

restarted mosquitto and checked it loaded:
![1767279455791](image/01-01-2026/1767279455791.png)

test connection to websocket port for mqtt:
![1767279725923](image/01-01-2026/1767279725923.png)

result:
![1767280885334](image/01-01-2026/1767280885334.png)

i added metrics.py to push events to mqtt for my table.

updated webpagetest.html to do websockets connection and dynamically update the table.

![1767281093939](image/01-01-2026/1767281093939.png)


part 3: setting up nginx, frontend, backend and SSL

I purchased a cheap domain from cloudflare to use for the server:
![1767286505462](image/01-01-2026/1767286505462.png)

changed the server to use a reserved ip address

i had a reserved added earlier but not actually attached to this instance as i deleted the original instance:
![1767289817006](image/01-01-2026/1767289817006.png)

to reserve it i needed to remove the IP and then re add it as reserved and to my specific one:
![1767289860258](image/01-01-2026/1767289860258.png)

I've added the reserved ip to cloudflare and sub domain pi-gaurdian.kcolville.com:
![1767290077815](image/01-01-2026/1767290077815.png)


Need to setup nginx on the server for my subdomain and test routing properly.

occasionally tested pinging pi-guardian.kcolville.ie until confirmed dns resolution:
![1767294185789](image/01-01-2026/1767294185789.png)

spent time on getting a backend structure up and going with express, typeorm and a local db.sqlite3 for testing.
The backend will manage auth and database access but having sound architecture to start with using Domain driven design.

![1767294410474](image/01-01-2026/1767294410474.png)

configured setup to use modern esm and confirmed decorator system working in javascript.
![1767295984898](image/01-01-2026/1767295984898.png)

confirmed database intialisation and the entity being written by typeorm:
![1767296106545](image/01-01-2026/1767296106545.png)

Need a frontend a dummy login system test locally.
the backend is pushed to localhost3000 so pushing vite react frontend at 3001 for testing.

npm create vite@latest

![1767296320281](image/01-01-2026/1767296320281.png)

![1767296348699](image/01-01-2026/1767296348699.png)

using atomic design architecture and gutting vite base:
![1767296986312](image/01-01-2026/1767296986312.png)

setup basic nav and footer with routing and clean frontend with react bootstrap:
![1767297625782](image/01-01-2026/1767297625782.png)


created seed script in backend and testing frontend can login:
![1767298990338](image/01-01-2026/1767298990338.png)

got backend and frontend communicating enough to do a secure route and actually login to a portal.

![1767299796971](image/01-01-2026/1767299796971.png)

extracted out the basic parts from webpagetest.html to make react components we could look at.
I held my phone up to the camera for happy new years on it.
![1767300550600](image/01-01-2026/1767300550600.png)
