setup publisher/subscriber system on the server so pie can send events to it.

sudo apt update
sudo apt install mosquitto mosquitto-clients

![1767270903753](image/01-01-2026/1767270903753.png)

starting the service:

sudo systemctl enable mosquitto
sudo systemctl start mosquitto

![1767270949504](image/01-01-2026/1767270949504.png)

MQTT uses port 1883 on http

Open ports on server: update the ip table and security list on cloud.

sudo iptables -A INPUT -p tcp --dport 1883 -j ACCEPT

![1767272015212](image/01-01-2026/1767272015212.png)

![1767272055695](image/01-01-2026/1767272055695.png)

check ports listening: ss -nltp

![1767272193402](image/01-01-2026/1767272193402.png)

test basic communication

on the pi or a local linux machine:
mosquitto_sub -h your.server.ip -t test/topic

on the server:
mosquitto_pub -h your.server.ip -t test/topic -m "hello"
fix ports if necessary and save

i ran sudo iptables -I INPUT 5 -p tcp --dport 1883 -m conntrack --ctstate NEW -j ACCEPT

![1767274152501](image/01-01-2026/1767274152501.png)
![1767274217423](image/01-01-2026/1767274217423.png)

confirm on pi communication:

![1767274242550](image/01-01-2026/1767274242550.png)

part 2:

need to setup a simple test by pushing some events from pie to our mqtt server expose websockets and transmit to frontend.
So full test of having frontend updates and the camera going all real time data.

opening port 9001 for mqtt websocket connection http upgrade

sudo iptables -I INPUT 5 -p tcp --dport 9001 -m conntrack --ctstate NEW -j ACCEPT
sudo iptables-restore < /etc/iptables/rules.v4
![1767279019959](image/01-01-2026/1767279019959.png)

![1767279151186](image/01-01-2026/1767279151186.png)

configure mosquitto to use websockets

sudo nano /etc/mosquitto/mosquitto.conf

added listener and protocol for the port and transmission method 1883 and 9001

![1767279353181](image/01-01-2026/1767279353181.png)

restarted mosquitto and checked it loaded:
![1767279455791](image/01-01-2026/1767279455791.png)

test connection to websocket port for mqtt:
![1767279725923](image/01-01-2026/1767279725923.png)
