Starting today off making a logo for the new frontend and generating a favicon based on the final design.
Giving myself 20 minutes and no more to do it and move on. Using photopea (free photoshop) and some flavicon pngs.

![1767354855438](image/02-01-2026/1767354855438.png)

![1767355663963](image/02-01-2026/1767355663963.png)

![1767355867237](image/02-01-2026/1767355867237.png)

using favicon generator

![1767356935941](image/02-01-2026/1767356935941.png)

part 2. putting nginx onto the server and configuring HTTPS with backend and frontend.

installing nginx:
![1767357644381](image/02-01-2026/1767357644381.png)

I copied over the backend and frontend to the server:
![1767362518558](image/02-01-2026/1767362518558.png)

located the sites available folder in nginx webserver:
![1767362732554](image/02-01-2026/1767362732554.png)

I opened up ports 80 and 443 for http and https in oracle cloud default security list:
![1767363155246](image/02-01-2026/1767363155246.png)

manually edited the ip table for these ports:
![1767363276751](image/02-01-2026/1767363276751.png)

I added the configuration for nginx and named it pi-guardian and confirmed the static frontend loading properly:


```nginx
server {
    listen 80;
    server_name pi-guardian.kcolville.com;

    root /home/ubuntu/pi-guardian/frontend/dist;  # Frontend static
    index index.html;

    # Serve frontend static files
    location / {
        try_files $uri /index.html;
    }

    # Proxy API requests to backend Node app
    location /api/ {
        proxy_pass http://localhost:3000/;   # Backend process
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # logs
    access_log /var/log/nginx/pi-guardian.access.log;
    error_log /var/log/nginx/pi-guardian.error.log;
}

```

working properly on http:
![1767363826254](image/02-01-2026/1767363826254.png)

i installed certbot to get self signed ssl for site:
sudo apt install certbot python3-certbot-nginx -y


configured certbot for the domain:
![1767365097249](image/02-01-2026/1767365097249.png)

went through certbot process and selected redirect to ssl option so it would overwrite my conf i wrote for it:
![1767365349025](image/02-01-2026/1767365349025.png)


i checked the file running nano and can see the acme challange and config is successful. it now directs to https:
![1767365433954](image/02-01-2026/1767365433954.png)

was having an issue loading

![1767365599435](image/02-01-2026/1767365599435.png)

went around to check the iptable and ports in security list and spotted a logical error accidently opening port 433 instead of 443 in the security list, ammended:



![1767365655244](image/02-01-2026/1767365655244.png)

the site is now working on https and redirects properly and has a letsencrypt ssl cert:
![1767365712892](image/02-01-2026/1767365712892.png)

part 2: configuring backend on the server to run on systemd

I curled node 20 to save for apt and then installed.

i was about to test the backend running when got an npm error on the version so went about updating it:
![1767366071992](image/02-01-2026/1767366071992.png)

after some initial setup and removing node_modules etc i managed to get the dev version running:
![1767366251545](image/02-01-2026/1767366251545.png)

I was able to see that the frontend didnt have my latest env files in the build so went about updating the frontend dist folder:
![1767366356523](image/02-01-2026/1767366356523.png)

![1767366392897](image/02-01-2026/1767366392897.png)

Just basic copy and pasting the dist over to the remote ssh window open.

the backend was running and i restarted nginx but then got a 405 error when trying to login.
![1767366542572](image/02-01-2026/1767366542572.png)

after a small bit of digging I found the issue on stack overflow that nginx blocks "POST" method on static site.
I copied the server nginx version to my local setup using ssh scp -r command

https://stackoverflow.com/questions/24415376/post-request-not-allowed-405-not-allowed-nginx-even-with-headers-included

![1767366772595](image/02-01-2026/1767366772595.png)

i tested adding the error_page  405     =200 $uri; to it

that didnt work, as suspected it was simply rewriting the status code and nothing else.

On further inspection it became obvious this was a proxy issue and I was not actually routing to the backend as the /api/ part of the url was completely missing in the request:
![1767367161987](image/02-01-2026/1767367161987.png)

I updated the env files, rebuilt the frontend and swapped them out and restarted nginx again:
![1767367251915](image/02-01-2026/1767367251915.png)

got a new error 404 on the route with some more feedback:

It appears the route doesnt exist.

I started getting issues with the server being unresponsive, I noticed it happening several times today and when I set up ssh with vscode for copy pasting.
I decided to stop doing that and restart on oracle cloud. I only have 0.5G of ram on it.

did a forced reboot as it was unresponsive:
![1767367849499](image/02-01-2026/1767367849499.png)

got back to my error again:
![1767367938638](image/02-01-2026/1767367938638.png)
![1767367402869](image/02-01-2026/1767367402869.png)

went to the location of my error handlers for the express backend and confirmed it was the backend was responding with that text:
![1767368021131](image/02-01-2026/1767368021131.png)

This was obviously a routing issue to the backend as that route wasnt recognised. I accidently left a leading slash on the background process.
I removed the leading slash as it was proxying and missing the /api/ portion of the url

![1767368313735](image/02-01-2026/1767368313735.png)

I managed to login successfully:
![1767368384671](image/02-01-2026/1767368384671.png)

I was getting an issue then with assets after logging in:
![1767368490640](image/02-01-2026/1767368490640.png)

I went to the frontend to inspect these components updated them to use https.

I restarted the pi etc and managed to get the camera system connected properly but the mqtt was still an issue:
![1767369925908](image/02-01-2026/1767369925908.png)

![1767369934143](image/02-01-2026/1767369934143.png)

I managed to proxy traffic properly for nginx with websocket upgrades as well.
However, I was able to see that my mqtt was not routing properly.

after a bit of research i could see from curl tests that the passing of traffic was not working because mqtt was listening on the outside port. so i configured for localhost:
![1767370583202](image/02-01-2026/1767370583202.png)

I could see we were now not able to send metrics by going back to the pi and checking it:
![1767370875894](image/02-01-2026/1767370875894.png)

after some investigating I found that he iptable rules i setup for 9001 never persisted. I put the file back to its original state and managed to get it working:
![1767372221230](image/02-01-2026/1767372221230.png)

still had an error getting the metrics shown properly and connecting to the mqtt in frontend:
![1767372419182](image/02-01-2026/1767372419182.png)

I decided to test proxy passing mqtt to the backend.
I set up the development version and its working locally but only on http if we switch to https as is in production we get the error.

It became obvious to me that the issue must be on the nginx side if all is working on the http protocol. I started looking into the conf file.

after many unsuccessful attempts the issue was indeed nginx passing the traffic properly on upgraded wss connections.

all working publicly:
![1767383015498](image/02-01-2026/1767383015498.png)

I set up the backend as a systemd process on the server:
![1767386283244](image/02-01-2026/1767386283244.png)

![1767386495428](image/02-01-2026/1767386495428.png)
